-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS users
(
    user_id serial,
    login character varying(20) NOT NULL,
    passwd character varying(255) NOT NULL,
    email character varying(100) NOT NULL,
    time_user timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (user_id),
    CONSTRAINT login UNIQUE (login),
    CONSTRAINT email UNIQUE (email)
);

CREATE TABLE IF NOT EXISTS publications
(
    public_id serial,
    description text,
    style_id integer,
    time_public timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    video_path text NOT NULL,
    user_id integer NOT NULL,
    PRIMARY KEY (public_id),
    CONSTRAINT video_path UNIQUE (video_path)
);

CREATE TABLE IF NOT EXISTS styles
(
    style_id serial,
    style character varying(20) NOT NULL,
    PRIMARY KEY (style_id)
);

CREATE TABLE IF NOT EXISTS likes_public
(
    user_id integer,
    public_id integer,
    time_likes timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (user_id, public_id)
);

CREATE TABLE IF NOT EXISTS comment_public
(
    user_id integer,
    public_id integer,
    time_comment timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    comment_text text NOT NULL,
    PRIMARY KEY (user_id, public_id)
);

CREATE TABLE IF NOT EXISTS followers
(
    user_id integer,
    follower_id integer,
    PRIMARY KEY (user_id, follower_id)
);

ALTER TABLE IF EXISTS publications
    ADD CONSTRAINT style_id FOREIGN KEY (style_id)
    REFERENCES styles (style_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS publications
    ADD CONSTRAINT user_id FOREIGN KEY (user_id)
    REFERENCES users (user_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE
    NOT VALID;


ALTER TABLE IF EXISTS likes_public
    ADD CONSTRAINT user_id FOREIGN KEY (user_id)
    REFERENCES users (user_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS likes_public
    ADD CONSTRAINT public_id FOREIGN KEY (public_id)
    REFERENCES publications (public_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE
    NOT VALID;


ALTER TABLE IF EXISTS comment_public
    ADD CONSTRAINT user_id FOREIGN KEY (user_id)
    REFERENCES users (user_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS comment_public
    ADD CONSTRAINT public_id FOREIGN KEY (public_id)
    REFERENCES publications (public_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE
    NOT VALID;


ALTER TABLE IF EXISTS followers
    ADD CONSTRAINT user_id FOREIGN KEY (user_id)
    REFERENCES users (user_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS followers
    ADD CONSTRAINT follower_id FOREIGN KEY (follower_id)
    REFERENCES users (user_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;

END;
